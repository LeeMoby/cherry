<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.moby.dao.DeviceDAO">
    <select id="getDeviceByID" parameterType="Long" resultType="Device">
        SELECT d.did, d.dname, d.dtid, d.dno, d.cid, d.dplace,
          d.dmodel, d.dcode, d.dip, d.dstatus, d.usedate, d.psupplier,
          d.department, d.nettype, d.person, d.oid, d.defid, d.fid,
          d.projectid, d.originalvalue, d.serialnumber,
          dt.dtid "deviceType.dtid", dt.dtno "deviceType.dtno",
          dt.dtname "deviceType.dtname", dt.sortno "deviceType.sortno",
          c.cid "cabinet.cid", c.cno "cabinet.cno", c.cname "cabinet.cname",
          c.ctype "cabinet.ctype", c.rid "cabinet.rid", r.rid "cabinet.room.rid",
          r.rname "cabinet.room.rname", r.rno "cabinet.room.rno"
        FROM tb_device d
        LEFT OUTER JOIN tb_device_type dt ON d.dtid = dt.dtid
        LEFT OUTER JOIN tb_cabinet c ON d.cid = c.cid
        LEFT OUTER JOIN tb_room r ON c.rid = r.rid
        WHERE d.did = #{deviceID};
    </select>

    <select id="findAllDevice" resultType="Device">
        SELECT d.did, d.dname, d.dtid, d.dno, d.cid, d.dplace,
          d.dmodel, d.dcode, d.dip, d.dstatus, d.usedate, d.psupplier,
          d.department, d.nettype, d.person, d.oid, d.defid, d.fid,
          d.projectid, d.originalvalue, d.serialnumber,
          dt.dtid "deviceType.dtid", dt.dtno "deviceType.dtno",
          dt.dtname "deviceType.dtname", dt.sortno "deviceType.sortno",
          c.cid "cabinet.cid", c.cno "cabinet.cno", c.cname "cabinet.cname",
          c.ctype "cabinet.ctype", c.rid "cabinet.rid", r.rid "cabinet.room.rid",
          r.rname "cabinet.room.rname", r.rno "cabinet.room.rno"
        FROM tb_device d
        LEFT OUTER JOIN tb_device_type dt ON d.dtid = dt.dtid
        LEFT OUTER JOIN tb_cabinet c ON d.cid = c.cid
        LEFT OUTER JOIN tb_room r ON c.rid = r.rid
        ORDER BY dt.dtno, d.dno;
    </select>

    <select id="findDeviceByDevice" parameterType="Device" resultType="Device">
        SELECT d.did, d.dname, d.dtid, d.dno, d.cid, d.dplace,
          d.dmodel, d.dcode, d.dip, d.dstatus, d.usedate, d.psupplier,
          d.department, d.nettype, d.person, d.oid, d.defid, d.fid,
          d.projectid, d.originalvalue, d.serialnumber,
          dt.dtid "deviceType.dtid", dt.dtno "deviceType.dtno",
          dt.dtname "deviceType.dtname", dt.sortno "deviceType.sortno",
          c.cid "cabinet.cid", c.cno "cabinet.cno", c.cname "cabinet.cname",
          c.ctype "cabinet.ctype", c.rid "cabinet.rid", r.rid "cabinet.room.rid",
          r.rname "cabinet.room.rname", r.rno "cabinet.room.rno"
        FROM tb_device d
        LEFT OUTER JOIN tb_device_type dt ON d.dtid = dt.dtid
        LEFT OUTER JOIN tb_cabinet c ON d.cid = c.cid
        LEFT OUTER JOIN tb_room r ON c.rid = r.rid
        <where>
            <if test="did != null">
              d.did = #{did}
            </if>
            <if test="dname != null">
                AND d.dname LIKE #{dname}
            </if>
            <if test="dtid != null">
                AND d.dtid = #{dtid}
            </if>
            <if test="dno != null">
                AND d.dno LIKE #{dno}
            </if>
            <if test="cid != null">
                AND d.cid = #{cid}
            </if>
            <if test="dplace != null">
                AND d.dplace LIKE #{dplace}
            </if>
            <if test="dmodel != null">
                AND d.dmodel LIKE #{dmodel}
            </if>
            <if test="dcode != null">
                AND d.dcode LIKE #{dcode}
            </if>
            <if test="dip != null">
                AND d.dip LIKE #{dip}
            </if>
            <if test="dstatus != null">
                AND d.dstatus LIKE #{dstatus}
            </if>
            <if test="useDate != null">
                AND d.usedate = #{useDate}
            </if>
            <if test="psupplier != null">
                AND d.psupplier LIKE #{psupplier}
            </if>
            <if test="department != null">
                AND d.department LIKE #{department}
            </if>
            <if test="nettype != null">
                AND d.nettype LIKE #{nettype}
            </if>
            <if test="person != null">
                AND d.person LIKE #{person}
            </if>
            <if test="oid != null">
                AND d.oid = #{oid}
            </if>
            <if test="defid != null">
                AND d.defid = #{defid}
            </if>
            <if test="fid != null">
                AND d.fid = #{fid}
            </if>
            <if test="projectid != null">
                AND d.projectid LIKE #{projectid}
            </if>
            <if test="originalValue != null">
                AND d.originalvalue LIKE #{originalValue}
            </if>
            <if test="serialNumber != null">
                AND d.serialnumber LIKE #{serialNumber}
            </if>
        </where>;
    </select>

    <insert id="addDevice">
        INSERT INTO tb_device (dname, dtid, dno,
            cid, dplace, dmodel, dcode, dip, dstatus,
            usedate, psupplier, department, nettype,
            person, oid, defid, fid, projectid,
            originalvalue, serialnumber)
        VALUES (#{dname}, #{dtid}, #{dno}, #{cid}, #{dplace},
            #{dmodel}, #{dcode}, #{dip}, #{dstatus},
            #{useDate}, #{psupplier}, #{department}, #{nettype},
            #{person}, #{oid}, #{defid}, #{fid}, #{projectid},
            #{originalValue}, #{serialNumber});
    </insert>

    <update id="updateDevice">
        UPDATE tb_device
        SET dname = #{dname}, dtid = #{dtid}, dno = #{dno}, cid = #{cid}, dplace = #{dplace},
            dmodel = #{dmodel}, dcode = #{dcode}, dip = #{dip}, dstatus = #{dstatus},
            usedate = #{useDate}, psupplier = #{psupplier}, department = #{department}, nettype = #{nettype},
            person = #{person}, oid = #{oid}, defid = #{defid}, fid = #{fid}, projectid = #{projectid},
            originalvalue = #{originalValue}, serialnumber = #{serialNumber}
        WHERE did = #{did};
    </update>

    <delete id="delDevice">
        DELETE FROM tb_device WHERE did = #{deviceID};
    </delete>

</mapper>